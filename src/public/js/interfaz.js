// Sample data for job offers
const jobOffers = [
  {
    id: "1",
    title: "Frontend Developer",
    description: "We are looking for a skilled Frontend Developer to join our team.",
    requirements: "3+ years of experience with React, TypeScript, and modern web technologies.",
    skills: ["React", "TypeScript", "HTML", "CSS", "JavaScript"],
    salary: "$80,000 - $100,000",
    contractType: "Full-time",
    modality: "Remote",
    status: "Active",
    companyLogo: "placeholder.svg",
    starred: false,
  },
  {
    id: "2",
    title: "Backend Engineer",
    description: "Join our engineering team to build scalable backend systems.",
    requirements: "Experience with Node.js, databases, and API design.",
    skills: ["Node.js", "Express", "MongoDB", "SQL", "API Design"],
    salary: "$90,000 - $110,000",
    contractType: "Full-time",
    modality: "Hybrid",
    status: "Active",
    companyLogo: "placeholder.svg",
    starred: true,
  },
  {
    id: "2",
    title: "Backend Engineer",
    description: "Join our engineering team to build scalable backend systems.",
    requirements: "Experience with Node.js, databases, and API design.",
    skills: ["Node.js", "Express", "MongoDB", "SQL", "API Design"],
    salary: "$90,000 - $110,000",
    contractType: "Full-time",
    modality: "Hybrid",
    status: "Active",
    companyLogo: "placeholder.svg",
    starred: true,
  },
  {
    id: "2",
    title: "Backend Engineer",
    description: "Join our engineering team to build scalable backend systems.",
    requirements: "Experience with Node.js, databases, and API design.",
    skills: ["Node.js", "Express", "MongoDB", "SQL", "API Design"],
    salary: "$90,000 - $110,000",
    contractType: "Full-time",
    modality: "Hybrid",
    status: "Active",
    companyLogo: "placeholder.svg",
    starred: true,
  },
  {
    id: "2",
    title: "Backend Engineer",
    description: "Join our engineering team to build scalable backend systems.",
    requirements: "Experience with Node.js, databases, and API design.",
    skills: ["Node.js", "Express", "MongoDB", "SQL", "API Design"],
    salary: "$90,000 - $110,000",
    contractType: "Full-time",
    modality: "Hybrid",
    status: "Active",
    companyLogo: "placeholder.svg",
    starred: true,
  },
  {
    id: "2",
    title: "Backend Engineer",
    description: "Join our engineering team to build scalable backend systems.",
    requirements: "Experience with Node.js, databases, and API design.",
    skills: ["Node.js", "Express", "MongoDB", "SQL", "API Design"],
    salary: "$90,000 - $110,000",
    contractType: "Full-time",
    modality: "Hybrid",
    status: "Active",
    companyLogo: "placeholder.svg",
    starred: true,
  },
  {
    id: "2",
    title: "Backend Engineer",
    description: "Join our engineering team to build scalable backend systems.",
    requirements: "Experience with Node.js, databases, and API design.",
    skills: ["Node.js", "Express", "MongoDB", "SQL", "API Design"],
    salary: "$90,000 - $110,000",
    contractType: "Full-time",
    modality: "Hybrid",
    status: "Active",
    companyLogo: "placeholder.svg",
    starred: true,
  },
  {
    id: "2",
    title: "Backend Engineer",
    description: "Join our engineering team to build scalable backend systems.",
    requirements: "Experience with Node.js, databases, and API design.",
    skills: ["Node.js", "Express", "MongoDB", "SQL", "API Design"],
    salary: "$90,000 - $110,000",
    contractType: "Full-time",
    modality: "Hybrid",
    status: "Active",
    companyLogo: "placeholder.svg",
    starred: true,
  },
  {
    id: "2",
    title: "Backend Engineer",
    description: "Join our engineering team to build scalable backend systems.",
    requirements: "Experience with Node.js, databases, and API design.",
    skills: ["Node.js", "Express", "MongoDB", "SQL", "API Design"],
    salary: "$90,000 - $110,000",
    contractType: "Full-time",
    modality: "Hybrid",
    status: "Active",
    companyLogo: "placeholder.svg",
    starred: true,
  },
  {
    id: "2",
    title: "Backend Engineer",
    description: "Join our engineering team to build scalable backend systems.",
    requirements: "Experience with Node.js, databases, and API design.",
    skills: ["Node.js", "Express", "MongoDB", "SQL", "API Design"],
    salary: "$90,000 - $110,000",
    contractType: "Full-time",
    modality: "Hybrid",
    status: "Active",
    companyLogo: "placeholder.svg",
    starred: true,
  },
  {
    id: "2",
    title: "Backend Engineer",
    description: "Join our engineering team to build scalable backend systems.",
    requirements: "Experience with Node.js, databases, and API design.",
    skills: ["Node.js", "Express", "MongoDB", "SQL", "API Design"],
    salary: "$90,000 - $110,000",
    contractType: "Full-time",
    modality: "Hybrid",
    status: "Active",
    companyLogo: "placeholder.svg",
    starred: true,
  },
  {
    id: "2",
    title: "Backend Engineer",
    description: "Join our engineering team to build scalable backend systems.",
    requirements: "Experience with Node.js, databases, and API design.",
    skills: ["Node.js", "Express", "MongoDB", "SQL", "API Design"],
    salary: "$90,000 - $110,000",
    contractType: "Full-time",
    modality: "Hybrid",
    status: "Active",
    companyLogo: "placeholder.svg",
    starred: true,
  },
  {
    id: "2",
    title: "Backend Engineer",
    description: "Join our engineering team to build scalable backend systems.",
    requirements: "Experience with Node.js, databases, and API design.",
    skills: ["Node.js", "Express", "MongoDB", "SQL", "API Design"],
    salary: "$90,000 - $110,000",
    contractType: "Full-time",
    modality: "Hybrid",
    status: "Active",
    companyLogo: "placeholder.svg",
    starred: true,
  },
  {
    id: "2",
    title: "Backend Engineer",
    description: "Join our engineering team to build scalable backend systems.",
    requirements: "Experience with Node.js, databases, and API design.",
    skills: ["Node.js", "Express", "MongoDB", "SQL", "API Design"],
    salary: "$90,000 - $110,000",
    contractType: "Full-time",
    modality: "Hybrid",
    status: "Active",
    companyLogo: "placeholder.svg",
    starred: true,
  },
  {
    id: "2",
    title: "Backend Engineer",
    description: "Join our engineering team to build scalable backend systems.",
    requirements: "Experience with Node.js, databases, and API design.",
    skills: ["Node.js", "Express", "MongoDB", "SQL", "API Design"],
    salary: "$90,000 - $110,000",
    contractType: "Full-time",
    modality: "Hybrid",
    status: "Active",
    companyLogo: "placeholder.svg",
    starred: true,
  },
  {
    id: "2",
    title: "Backend Engineer",
    description: "Join our engineering team to build scalable backend systems.",
    requirements: "Experience with Node.js, databases, and API design.",
    skills: ["Node.js", "Express", "MongoDB", "SQL", "API Design"],
    salary: "$90,000 - $110,000",
    contractType: "Full-time",
    modality: "Hybrid",
    status: "Active",
    companyLogo: "placeholder.svg",
    starred: true,
  },
  {
    id: "2",
    title: "Backend Engineer",
    description: "Join our engineering team to build scalable backend systems.",
    requirements: "Experience with Node.js, databases, and API design.",
    skills: ["Node.js", "Express", "MongoDB", "SQL", "API Design"],
    salary: "$90,000 - $110,000",
    contractType: "Full-time",
    modality: "Hybrid",
    status: "Active",
    companyLogo: "placeholder.svg",
    starred: true,
  },
  {
    id: "2",
    title: "Backend Engineer",
    description: "Join our engineering team to build scalable backend systems.",
    requirements: "Experience with Node.js, databases, and API design.",
    skills: ["Node.js", "Express", "MongoDB", "SQL", "API Design"],
    salary: "$90,000 - $110,000",
    contractType: "Full-time",
    modality: "Hybrid",
    status: "Active",
    companyLogo: "placeholder.svg",
    starred: true,
  },
  {
    id: "2",
    title: "Backend Engineer",
    description: "Join our engineering team to build scalable backend systems.",
    requirements: "Experience with Node.js, databases, and API design.",
    skills: ["Node.js", "Express", "MongoDB", "SQL", "API Design"],
    salary: "$90,000 - $110,000",
    contractType: "Full-time",
    modality: "Hybrid",
    status: "Active",
    companyLogo: "placeholder.svg",
    starred: true,
  },
  {
    id: "2",
    title: "Backend Engineer",
    description: "Join our engineering team to build scalable backend systems.",
    requirements: "Experience with Node.js, databases, and API design.",
    skills: ["Node.js", "Express", "MongoDB", "SQL", "API Design"],
    salary: "$90,000 - $110,000",
    contractType: "Full-time",
    modality: "Hybrid",
    status: "Active",
    companyLogo: "placeholder.svg",
    starred: true,
  },
  {
    id: "2",
    title: "Backend Engineer",
    description: "Join our engineering team to build scalable backend systems.",
    requirements: "Experience with Node.js, databases, and API design.",
    skills: ["Node.js", "Express", "MongoDB", "SQL", "API Design"],
    salary: "$90,000 - $110,000",
    contractType: "Full-time",
    modality: "Hybrid",
    status: "Active",
    companyLogo: "placeholder.svg",
    starred: true,
  },
  {
    id: "2",
    title: "Backend Engineer",
    description: "Join our engineering team to build scalable backend systems.",
    requirements: "Experience with Node.js, databases, and API design.",
    skills: ["Node.js", "Express", "MongoDB", "SQL", "API Design"],
    salary: "$90,000 - $110,000",
    contractType: "Full-time",
    modality: "Hybrid",
    status: "Active",
    companyLogo: "placeholder.svg",
    starred: true,
  },
  {
    id: "2",
    title: "Backend Engineer",
    description: "Join our engineering team to build scalable backend systems.",
    requirements: "Experience with Node.js, databases, and API design.",
    skills: ["Node.js", "Express", "MongoDB", "SQL", "API Design"],
    salary: "$90,000 - $110,000",
    contractType: "Full-time",
    modality: "Hybrid",
    status: "Active",
    companyLogo: "placeholder.svg",
    starred: true,
  },
  {
    id: "2",
    title: "Backend Engineer",
    description: "Join our engineering team to build scalable backend systems.",
    requirements: "Experience with Node.js, databases, and API design.",
    skills: ["Node.js", "Express", "MongoDB", "SQL", "API Design"],
    salary: "$90,000 - $110,000",
    contractType: "Full-time",
    modality: "Hybrid",
    status: "Active",
    companyLogo: "placeholder.svg",
    starred: true,
  },
  {
    id: "2",
    title: "Backend Engineer",
    description: "Join our engineering team to build scalable backend systems.",
    requirements: "Experience with Node.js, databases, and API design.",
    skills: ["Node.js", "Express", "MongoDB", "SQL", "API Design"],
    salary: "$90,000 - $110,000",
    contractType: "Full-time",
    modality: "Hybrid",
    status: "Active",
    companyLogo: "placeholder.svg",
    starred: true,
  },
  {
    id: "2",
    title: "Backend Engineer",
    description: "Join our engineering team to build scalable backend systems.",
    requirements: "Experience with Node.js, databases, and API design.",
    skills: ["Node.js", "Express", "MongoDB", "SQL", "API Design"],
    salary: "$90,000 - $110,000",
    contractType: "Full-time",
    modality: "Hybrid",
    status: "Active",
    companyLogo: "placeholder.svg",
    starred: true,
  },
  {
    id: "2",
    title: "Backend Engineer",
    description: "Join our engineering team to build scalable backend systems.",
    requirements: "Experience with Node.js, databases, and API design.",
    skills: ["Node.js", "Express", "MongoDB", "SQL", "API Design"],
    salary: "$90,000 - $110,000",
    contractType: "Full-time",
    modality: "Hybrid",
    status: "Active",
    companyLogo: "placeholder.svg",
    starred: true,
  },
  {
    id: "2",
    title: "Backend Engineer",
    description: "Join our engineering team to build scalable backend systems.",
    requirements: "Experience with Node.js, databases, and API design.",
    skills: ["Node.js", "Express", "MongoDB", "SQL", "API Design"],
    salary: "$90,000 - $110,000",
    contractType: "Full-time",
    modality: "Hybrid",
    status: "Active",
    companyLogo: "placeholder.svg",
    starred: true,
  },
  {
    id: "2",
    title: "Backend Engineer",
    description: "Join our engineering team to build scalable backend systems.",
    requirements: "Experience with Node.js, databases, and API design.",
    skills: ["Node.js", "Express", "MongoDB", "SQL", "API Design"],
    salary: "$90,000 - $110,000",
    contractType: "Full-time",
    modality: "Hybrid",
    status: "Active",
    companyLogo: "placeholdeeer.svg",
    starred: true,
  },
  {
    id: "2",
    title: "Backend Engineer",
    description: "Join our engineering team to build scalable backend systems.",
    requirements: "Experience with Node.js, databases, and API design.",
    skills: ["Node.js", "Express", "MongoDB", "SQL", "API Design"],
    salary: "$90,000 - $110,000",
    contractType: "Full-time",
    modality: "Hybrid",
    status: "Active",
    companyLogo: "placeholder.svg",
    starred: true,
  },

]

// DOM Elements
const jobCardsContainer = document.getElementById("job-cards-container")
const createJobBtn = document.getElementById("create-job-btn")
const jobModal = document.getElementById("job-modal")
const closeModalBtn = document.getElementById("close-modal-btn")
const modalTitle = document.getElementById("modal-title")
const jobFormContainer = document.getElementById("job-form-container")
const jobDetailsContainer = document.getElementById("job-details-container")
const jobOfferForm = document.getElementById("job-offer-form")
const cancelFormBtn = document.getElementById("cancel-form-btn")
const addSkillBtn = document.getElementById("add-skill-btn")
const skillsInput = document.getElementById("job-skills-input")
const skillsContainer = document.getElementById("skills-container")
const uploadLogoBtn = document.getElementById("upload-logo-btn")
const logoFileInput = document.getElementById("logo-file-input")
const logoPreview = document.getElementById("logo-preview")
const uploadModal = document.getElementById("upload-modal")
const closeUploadModalBtn = document.getElementById("close-upload-modal-btn")
const uploadDropzone = document.getElementById("upload-dropzone")
const previewImageContainer = document.getElementById("preview-image-container")
const previewImage = document.getElementById("preview-image")
const removePreviewBtn = document.getElementById("remove-preview-btn")
const uploadProgressContainer = document.getElementById("upload-progress-container")
const uploadProgressBar = document.getElementById("upload-progress-bar")
const uploadProgressText = document.getElementById("upload-progress-text")
const cancelUploadBtn = document.getElementById("cancel-upload-btn")
const confirmUploadBtn = document.getElementById("confirm-upload-btn")
const profileImg = document.querySelector(".nav-profile-img");
const menuPerfil = document.getElementById("menuPerfil");

// Funcionalidad para mostrar/ocultar el menú de perfil
profileImg.addEventListener("click", function() {
  if (menuPerfil.style.display === "block") {
    menuPerfil.style.display = "none";
  } else {
    menuPerfil.style.display = "block";
  }
});

// Cerrar el menú si se hace clic fuera de él
document.addEventListener("click", (event) => {
  if (!menuPerfil.contains(event.target) && !profileImg.contains(event.target)) {
    menuPerfil.style.display = "none";
  }
});

// State variables
let currentJobId = null
let currentSkills = []
let currentLogoUrl = "placeholder.svg"
let uploadedImageData = null
let isEditing = false

// Initialize the app
function init() {
  renderJobCards()
  setupEventListeners()
}

// Render all job cards
function renderJobCards() {
  jobCardsContainer.innerHTML = ""

  jobOffers.forEach((job) => {
    const jobCard = createJobCard(job)
    jobCardsContainer.appendChild(jobCard)
  })
}

// Create a job card element
function createJobCard(job) {
  const card = document.createElement("div")
  card.className = "job-card"
  card.dataset.id = job.id

  const skillsHtml = job.skills
    .slice(0, 3)
    .map((skill) => `<span class="skill-badge">${skill}</span>`)
    .join("")

  const moreSkillsHtml = job.skills.length > 3 ? `<span class="more-skills-badge">+${job.skills.length - 3}</span>` : ""

  card.innerHTML = `
    <div class="job-card-header">
      <div class="job-card-header-left">
        <div class="job-logo-container">
          <img src="${job.companyLogo}" alt="${job.title} logo" class="job-logo">
        </div>
        <div>
          <h3 class="job-title">${job.title}</h3>
          <p class="job-salary">${job.salary}</p>
        </div>
      </div>
      <button class="star-btn ${job.starred ? "starred" : ""}" data-id="${job.id}">
        <i class="fas fa-star"></i>
      </button>
    </div>
    <div class="job-card-content">
      <p class="job-description">${job.description}</p>
      <div class="job-skills">
        ${skillsHtml}
        ${moreSkillsHtml}
      </div>
    </div>
    <div class="job-card-footer">
      <div class="job-details">
        <span class="job-badge">${job.contractType}</span>
        <span class="job-badge">${job.modality}</span>
      </div>
      <span class="status-badge ${job.status.toLowerCase()}">${job.status}</span>
    </div>
  `

  return card
}

// Set up event listeners
function setupEventListeners() {
  // Create job button
  createJobBtn.addEventListener("click", () => {
    openCreateJobModal()
  })

  // Close modal button
  closeModalBtn.addEventListener("click", () => {
    closeModal()
  })

  // Cancel form button
  cancelFormBtn.addEventListener("click", () => {
    closeModal()
  })

  // Job card click
  jobCardsContainer.addEventListener("click", (e) => {
    const jobCard = e.target.closest(".job-card")
    if (jobCard) {
      const starBtn = e.target.closest(".star-btn")
      if (starBtn) {
        // Toggle star
        toggleJobStar(starBtn.dataset.id)
      } else {
        // Open job details
        openJobDetails(jobCard.dataset.id)
      }
    }
  })

  // Add skill button
  addSkillBtn.addEventListener("click", addSkill)

  // Skills input enter key
  skillsInput.addEventListener("keypress", (e) => {
    if (e.key === "Enter") {
      e.preventDefault()
      addSkill()
    }
  })

  // Job form submit
  jobOfferForm.addEventListener("submit", (e) => {
    e.preventDefault()
    submitJobForm()
  })

  // Upload logo button
  uploadLogoBtn.addEventListener("click", () => {
    openUploadModal()
  })

  // Close upload modal
  closeUploadModalBtn.addEventListener("click", () => {
    closeUploadModal()
  })

  // Cancel upload button
  cancelUploadBtn.addEventListener("click", () => {
    closeUploadModal()
  })

  // Upload dropzone click
  uploadDropzone.addEventListener("click", () => {
    logoFileInput.click()
  })

  // File input change
  logoFileInput.addEventListener("change", handleFileSelect)

  // Remove preview button
  removePreviewBtn.addEventListener("click", () => {
    clearPreviewImage()
  })

  // Confirm upload button
  confirmUploadBtn.addEventListener("click", () => {
    simulateUpload()
  })

  // Close modal when clicking outside
  window.addEventListener("click", (e) => {
    if (e.target === jobModal) {
      closeModal()
    }
    if (e.target === uploadModal) {
      closeUploadModal()
    }
  })

  // Drag and drop for upload
  setupDragAndDrop()
}

// Open create job modal
function openCreateJobModal() {
  resetForm()
  currentJobId = null
  isEditing = true
  modalTitle.textContent = "Create Job Offer"
  jobFormContainer.style.display = "block"
  jobDetailsContainer.style.display = "none"
  jobModal.style.display = "block"
}

// Open job details modal
function openJobDetails(jobId) {
  const job = jobOffers.find((job) => job.id === jobId)
  if (!job) return

  currentJobId = jobId
  isEditing = false
  modalTitle.textContent = job.title

  // Render job details
  jobDetailsContainer.innerHTML = createJobDetailsHtml(job)

  // Add edit button event listener
  const editBtn = jobDetailsContainer.querySelector("#edit-job-btn")
  if (editBtn) {
    editBtn.addEventListener("click", () => {
      openEditJobModal(jobId)
    })
  }

  jobFormContainer.style.display = "none"
  jobDetailsContainer.style.display = "block"
  jobModal.style.display = "block"
}

// Create HTML for job details
function createJobDetailsHtml(job) {
  const skillsHtml = job.skills.map((skill) => `<span class="skill-badge">${skill}</span>`).join("")

  return `
    <div class="job-details-container">
      <div class="job-details-header">
        <div class="job-details-logo">
          <img src="${job.companyLogo}" alt="${job.title} logo">
        </div>
        <div>
          <h2 class="job-details-title">${job.title}</h2>
          <p class="job-details-salary">${job.salary}</p>
        </div>
      </div>
      
      <div class="job-details-section">
        <h3>Description</h3>
        <p>${job.description}</p>
      </div>
      
      <div class="job-details-section">
        <h3>Requirements</h3>
        <p>${job.requirements}</p>
      </div>
      
      <div class="job-details-section">
        <h3>Skills</h3>
        <div class="job-details-skills">
          ${skillsHtml}
        </div>
      </div>
      
      <div class="job-details-info">
        <div class="job-details-info-item">
          <h3>Contract Type</h3>
          <span class="job-badge">${job.contractType}</span>
        </div>
        <div class="job-details-info-item">
          <h3>Modality</h3>
          <span class="job-badge">${job.modality}</span>
        </div>
        <div class="job-details-info-item">
          <h3>Status</h3>
          <span class="status-badge ${job.status.toLowerCase()}">${job.status}</span>
        </div>
      </div>
      
      <div class="job-details-actions">
        <button id="edit-job-btn" class="btn btn-primary">Edit Job Offer</button>
      </div>
    </div>
  `
}

// Open edit job modal
function openEditJobModal(jobId) {
  const job = jobOffers.find((job) => job.id === jobId)
  if (!job) return

  resetForm()
  populateForm(job)
  currentJobId = jobId
  isEditing = true
  modalTitle.textContent = "Edit Job Offer"
  jobFormContainer.style.display = "block"
  jobDetailsContainer.style.display = "none"
}

// Close modal
function closeModal() {
  jobModal.style.display = "none"
  resetForm()
}

// Reset form
function resetForm() {
  jobOfferForm.reset()
  currentSkills = []
  currentLogoUrl = "placeholder.svg"
  skillsContainer.innerHTML = ""
  logoPreview.src = currentLogoUrl
}

// Populate form with job data
function populateForm(job) {
  document.getElementById("job-title").value = job.title
  document.getElementById("job-description").value = job.description
  document.getElementById("job-requirements").value = job.requirements
  document.getElementById("job-salary").value = job.salary
  document.getElementById("job-contract-type").value = job.contractType
  document.getElementById("job-modality").value = job.modality
  document.getElementById("job-status").value = job.status

  currentSkills = [...job.skills]
  renderSkills()

  currentLogoUrl = job.companyLogo
  logoPreview.src = currentLogoUrl
}

// Add skill
function addSkill() {
  const skill = skillsInput.value.trim()
  if (skill && !currentSkills.includes(skill)) {
    currentSkills.push(skill)
    renderSkills()
    skillsInput.value = ""
  }
}

// Remove skill
function removeSkill(skill) {
  currentSkills = currentSkills.filter((s) => s !== skill)
  renderSkills()
}

// Render skills
function renderSkills() {
  skillsContainer.innerHTML = ""

  currentSkills.forEach((skill) => {
    const skillElement = document.createElement("div")
    skillElement.className = "skill-item"
    skillElement.innerHTML = `
      ${skill}
      <button type="button" class="remove-skill-btn" data-skill="${skill}">×</button>
    `
    skillsContainer.appendChild(skillElement)
  })

  // Add event listeners to remove buttons
  const removeButtons = skillsContainer.querySelectorAll(".remove-skill-btn")
  removeButtons.forEach((btn) => {
    btn.addEventListener("click", () => {
      removeSkill(btn.dataset.skill)
    })
  })
}

// Submit job form
function submitJobForm() {
  const formData = new FormData(jobOfferForm)

  const jobData = {
    title: formData.get("title"),
    description: formData.get("description"),
    requirements: formData.get("requirements"),
    skills: currentSkills,
    salary: formData.get("salary"),
    contractType: formData.get("contractType"),
    modality: formData.get("modality"),
    status: formData.get("status"),
    companyLogo: currentLogoUrl,
  }

  if (currentJobId) {
    // Update existing job
    updateJob(currentJobId, jobData)
  } else {
    // Add new job
    addJob(jobData)
  }

  closeModal()
}

// Add new job
function addJob(jobData) {
  const newJob = {
    id: Date.now().toString(),
    ...jobData,
    starred: false,
  }

  jobOffers.unshift(newJob)
  renderJobCards()
}

// Update existing job
function updateJob(jobId, jobData) {
  const index = jobOffers.findIndex((job) => job.id === jobId)
  if (index !== -1) {
    const starred = jobOffers[index].starred
    jobOffers[index] = {
      ...jobData,
      id: jobId,
      starred,
    }
    renderJobCards()
  }
}

// Toggle job star
function toggleJobStar(jobId) {
  const index = jobOffers.findIndex((job) => job.id === jobId)
  if (index !== -1) {
    jobOffers[index].starred = !jobOffers[index].starred
    renderJobCards()
  }
}

// Open upload modal
function openUploadModal() {
  uploadModal.style.display = "block"
  previewImageContainer.style.display = "none"
  uploadDropzone.style.display = "block"
  uploadProgressContainer.style.display = "none"
  confirmUploadBtn.disabled = true
}

// Close upload modal
function closeUploadModal() {
  uploadModal.style.display = "none"
  uploadedImageData = null
}

// Handle file select
function handleFileSelect(e) {
  const file = e.target.files[0]
  if (file) {
    const reader = new FileReader()
    reader.onload = (event) => {
      uploadedImageData = event.target.result
      showPreviewImage(uploadedImageData)
    }
    reader.readAsDataURL(file)
  }
}

// Show preview image
function showPreviewImage(imageData) {
  previewImage.src = imageData
  uploadDropzone.style.display = "none"
  previewImageContainer.style.display = "block"
  confirmUploadBtn.disabled = false
}

// Clear preview image
function clearPreviewImage() {
  uploadedImageData = null
  previewImageContainer.style.display = "none"
  uploadDropzone.style.display = "block"
  confirmUploadBtn.disabled = true
}

// Simulate upload
function simulateUpload() {
  if (!uploadedImageData) return

  uploadProgressContainer.style.display = "block"
  confirmUploadBtn.disabled = true
  cancelUploadBtn.disabled = true

  let progress = 0
  const interval = setInterval(() => {
    progress += 10
    uploadProgressBar.style.width = `${progress}%`
    uploadProgressText.textContent = `Uploading... ${progress}%`

    if (progress >= 100) {
      clearInterval(interval)
      setTimeout(() => {
        currentLogoUrl = uploadedImageData
        logoPreview.src = currentLogoUrl
        closeUploadModal()
        confirmUploadBtn.disabled = false
        cancelUploadBtn.disabled = false
      }, 500)
    }
  }, 300)
}

// Setup drag and drop
function setupDragAndDrop() {
  ;["dragenter", "dragover", "dragleave", "drop"].forEach((eventName) => {
    uploadDropzone.addEventListener(eventName, preventDefaults, false)
  })

  function preventDefaults(e) {
    e.preventDefault()
    e.stopPropagation()
  }
  ;["dragenter", "dragover"].forEach((eventName) => {
    uploadDropzone.addEventListener(eventName, highlight, false)
  })
  ;["dragleave", "drop"].forEach((eventName) => {
    uploadDropzone.addEventListener(eventName, unhighlight, false)
  })

  function highlight() {
    uploadDropzone.classList.add("highlight")
  }

  function unhighlight() {
    uploadDropzone.classList.remove("highlight")
  }

  uploadDropzone.addEventListener("drop", handleDrop, false)

  function handleDrop(e) {
    const dt = e.dataTransfer
    const file = dt.files[0]

    if (file && file.type.match("image.*")) {
      const reader = new FileReader()
      reader.onload = (event) => {
        uploadedImageData = event.target.result
        showPreviewImage(uploadedImageData)
      }
      reader.readAsDataURL(file)
    }
  }
}

// Create placeholder SVG
function createPlaceholderSVG() {
  const svg = document.getElementById("placeholder-svg")
  const svgData = new XMLSerializer().serializeToString(svg)
  const svgBlob = new Blob([svgData], { type: "image/svg+xml" })
  return URL.createObjectURL(svgBlob)
}

// Initialize the app when DOM is loaded
document.addEventListener("DOMContentLoaded", init)

document.addEventListener('DOMContentLoaded', function() {
  createJobBtn.addEventListener('click', function() {
    jobModal.classList.add('active');
  });

  closeModalBtn.addEventListener('click', function() {
    jobModal.classList.remove('active');
  });

  uploadLogoBtn.addEventListener('click', function() {
    logoFileInput.click();
  });

  logoFileInput.addEventListener('change', function(event) {
    const file = event.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = function(e) {
        logoPreview.src = e.target.result;
      };
      reader.readAsDataURL(file);
    }
  });

  uploadDropzone.addEventListener('click', function() {
    logoFileInput.click();
  });

  logoFileInput.addEventListener('change', function(event) {
    const file = event.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = function(e) {
        previewImage.src = e.target.result;
        previewImageContainer.style.display = 'block';
        uploadDropzone.style.display = 'none';
      };
      reader.readAsDataURL(file);
    }
  });

  removePreviewBtn.addEventListener('click', function() {
    previewImage.src = 'placeholder.svg';
    previewImageContainer.style.display = 'none';
    uploadDropzone.style.display = 'block';
    logoFileInput.value = '';
  });

  closeUploadModalBtn.addEventListener('click', function() {
    uploadModal.classList.remove('active');
  });

  cancelUploadBtn.addEventListener('click', function() {
    uploadModal.classList.remove('active');
  });

  confirmUploadBtn.addEventListener('click', function() {
    uploadProgressContainer.style.display = 'block';
    let progress = 0;
    const interval = setInterval(function() {
      progress += 10;
      uploadProgressBar.style.width = progress + '%';
      uploadProgressText.textContent = 'Uploading... ' + progress + '%';
      if (progress >= 100) {
        clearInterval(interval);
        uploadModal.classList.remove('active');
        uploadProgressContainer.style.display = 'none';
        uploadProgressBar.style.width = '0%';
        uploadProgressText.textContent = 'Uploading... 0%';
      }
    }, 100);
  });
});